<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ARChain | Sovereign Command Center</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;500;800&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.17.0/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd@2.2.3/dist/coco-ssd.min.js"></script>
<style>
:root{
  --accent:#ff0000;
  --accent-soft:rgba(255,0,0,.25);
  --accent-glow:0 0 30px rgba(255,0,0,.6);
  --glass-light:rgba(15,15,15,.4);
  --glass-heavy:rgba(20,20,20,.85);
  --text-primary:#ffffff;
  --text-muted:rgba(255,255,255,.6);
  --border-glass:1px solid rgba(255,0,0,.25);
}
*{box-sizing:border-box;margin:0;padding:0;-webkit-font-smoothing:antialiased}
body{font-family:'JetBrains Mono',monospace;background:#000;color:#fff;height:100vh;overflow:hidden;}

/* ‚îÄ‚îÄ PAGE SYSTEM ‚îÄ‚îÄ */
.page{display:none;height:100vh;}
.page.active{display:flex;}
#scanPage{display:none;height:100vh;overflow-y:auto;background:#030000;flex-direction:column;}
#scanPage.active{display:block;}

/* ‚îÄ‚îÄ TRANSITION OVERLAY ‚îÄ‚îÄ */
#transition{position:fixed;inset:0;background:#000;z-index:9999;opacity:0;pointer-events:none;transition:opacity .4s ease;}
#transition.show{opacity:1;pointer-events:all;}

/* ‚îÄ‚îÄ BG CANVAS (dashboard) ‚îÄ‚îÄ */
#bgCanvas{position:fixed;top:0;left:0;z-index:0;pointer-events:none;}
.energy-layer{position:fixed;inset:0;background:radial-gradient(circle at 30% 40%,rgba(255,0,0,.12),transparent 40%),radial-gradient(circle at 70% 60%,rgba(255,0,0,.08),transparent 40%);animation:floatE 14s ease-in-out infinite alternate;z-index:1;pointer-events:none;}
@keyframes floatE{0%{transform:translate(0,0) scale(1)}50%{transform:translate(-25px,18px) scale(1.04)}100%{transform:translate(18px,-22px) scale(1.02)}}
.cursor-glow{position:fixed;width:380px;height:380px;background:radial-gradient(circle,rgba(255,0,0,.18) 0%,transparent 65%);border-radius:50%;pointer-events:none;transform:translate(-50%,-50%);z-index:3;}

/* ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ */
.app{display:flex;width:100%;height:100%;position:relative;z-index:4;}

/* ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ */
.sidebar{width:280px;background:var(--glass-light);backdrop-filter:blur(28px);border-right:var(--border-glass);padding:36px 22px;display:flex;flex-direction:column;flex-shrink:0;transition:transform .5s cubic-bezier(.77,0,.175,1);z-index:10;}
.sidebar.collapsed{transform:translateX(-280px);}
.sidebar__logo{font-size:2.2rem;font-weight:800;letter-spacing:-1px;color:var(--accent);text-shadow:var(--accent-glow);margin-bottom:42px;}
.sidebar__nav{display:flex;flex-direction:column;gap:8px;}
.nav-item{display:flex;align-items:center;gap:12px;padding:13px;cursor:pointer;color:var(--text-muted);transition:all .3s;user-select:none;font-size:.82rem;}
.nav-item:hover{background:var(--accent-soft);color:var(--accent);}
.sidebar__footer{margin-top:auto;display:flex;flex-direction:column;gap:10px;}

/* ‚îÄ‚îÄ MENU TOGGLE ‚îÄ‚îÄ */
#menuToggle{position:fixed;top:18px;left:18px;z-index:20;background:rgba(10,0,0,.7);border:1px solid var(--accent);color:var(--accent);padding:9px 13px;cursor:pointer;font-family:'JetBrains Mono',monospace;font-size:1.1rem;transition:all .3s;backdrop-filter:blur(10px);}
#menuToggle:hover{background:var(--accent);color:#000;}

/* ‚îÄ‚îÄ MAIN CONTENT ‚îÄ‚îÄ */
.main{flex:1;padding:36px 50px;overflow-y:auto;overflow-x:hidden;}
.main::-webkit-scrollbar{width:3px;}
.main::-webkit-scrollbar-thumb{background:var(--accent-soft);}

/* ‚îÄ‚îÄ HERO ‚îÄ‚îÄ */
.hero{margin-bottom:42px;border-bottom:2px solid var(--accent);padding-bottom:22px;padding-top:8px;}
.hero__title{font-size:2.4rem;font-weight:800;letter-spacing:-1px;}
.hero__subtitle{color:var(--accent);margin-top:8px;font-size:.9rem;letter-spacing:2px;}
.pulse-bar{display:flex;align-items:center;gap:12px;margin-top:10px;font-size:.72rem;color:var(--text-muted);}
#pulseIndicator{width:10px;height:10px;border-radius:50%;background:#00ff88;box-shadow:0 0 8px #00ff88;}

/* ‚îÄ‚îÄ GRID ‚îÄ‚îÄ */
.dashboard-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:20px;margin-bottom:44px;}

/* ‚îÄ‚îÄ CARD ‚îÄ‚îÄ */
.card{background:var(--glass-heavy);border:var(--border-glass);padding:26px;cursor:default;position:relative;overflow:hidden;transition:all .4s cubic-bezier(.25,.8,.25,1);backdrop-filter:blur(20px);}
.card::before{content:'';position:absolute;left:0;top:-100%;width:100%;height:3px;background:linear-gradient(90deg,transparent,var(--accent),transparent);opacity:0;z-index:5;}
.card:hover::before{opacity:1;top:110%;transition:top .7s ease,opacity .1s ease;}
.card:hover{transform:scale(1.03);box-shadow:0 0 35px rgba(255,0,0,.5);border-color:var(--accent);}
.card__title{color:var(--accent);margin-bottom:10px;font-size:.88rem;letter-spacing:1px;}
.card__text{font-size:.78rem;color:var(--text-muted);margin-bottom:18px;line-height:1.55;}
.card-holo-wrap{margin-bottom:14px;height:110px;border:1px solid rgba(255,0,0,.2);background:radial-gradient(circle at center,rgba(255,0,0,.04),transparent);overflow:hidden;}
.card-holo-wrap canvas{width:100%;height:100%;display:block;}

/* ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ */
.btn{background:transparent;border:2px solid var(--accent);padding:11px 16px;font-family:'JetBrains Mono',monospace;font-weight:800;font-size:.75rem;color:#fff;text-transform:uppercase;cursor:pointer;position:relative;overflow:hidden;width:100%;display:block;transition:background .3s,box-shadow .3s;}
.btn:hover{background:var(--accent);color:#000;box-shadow:0 8px 24px rgba(255,0,0,.35);}
.btn:active{transform:scale(.96);}
.btn.sec{border-color:rgba(255,255,255,.2);color:var(--text-muted);}
.btn.sec:hover{background:rgba(255,255,255,.08);color:#fff;}

/* ‚îÄ‚îÄ HOLO SECTION ‚îÄ‚îÄ */
.holo-section{margin-bottom:44px;height:380px;border:1px solid rgba(255,0,0,.3);position:relative;overflow:hidden;background:radial-gradient(circle at center,rgba(255,0,0,.05),transparent);}
.holo-label{position:absolute;top:13px;left:17px;color:var(--accent);font-size:.75rem;letter-spacing:2px;z-index:2;}
.holo-stats{position:absolute;top:13px;right:17px;font-size:.68rem;color:rgba(255,0,0,.6);z-index:2;text-align:right;line-height:1.8;}
#holoCanvas{width:100%;height:100%;display:block;}

/* ‚îÄ‚îÄ TELEMETRY ‚îÄ‚îÄ */
.telemetry-panel{margin-bottom:44px;padding:22px;background:rgba(10,0,0,.8);border:1px solid rgba(255,0,0,.4);}
.telemetry-panel h3{color:var(--accent);margin-bottom:16px;font-size:.82rem;letter-spacing:2px;}
#sensorData{font-size:.82rem;color:rgba(255,255,255,.7);line-height:2;margin-bottom:10px;}
.sensor-status{display:inline-block;padding:3px 11px;font-size:.7rem;font-weight:800;margin-bottom:16px;letter-spacing:1px;}
.sensor-status.normal{border:1px solid #00ff88;color:#00ff88;}
.sensor-status.warning{border:1px solid #ff0000;color:#ff0000;animation:wb 1s infinite;}
@keyframes wb{0%,100%{opacity:1}50%{opacity:.5}}
#sensorChart{max-height:160px;}

/* ‚îÄ‚îÄ AI CONSOLE ‚îÄ‚îÄ */
.ai-console{margin-bottom:50px;background:#030000;border:1px solid rgba(255,0,0,.4);padding:22px;position:relative;overflow:hidden;}
.ai-console::before{content:'';position:absolute;left:0;top:0;width:100%;height:1px;background:linear-gradient(90deg,transparent,var(--accent),transparent);animation:sc 3s linear infinite;}
@keyframes sc{0%{transform:translateY(0);opacity:0}10%{opacity:1}90%{opacity:1}100%{transform:translateY(200px);opacity:0}}
.console-header{color:#ff0000;margin-bottom:12px;font-size:.8rem;letter-spacing:2px;display:flex;align-items:center;gap:10px;}
.console-dot{width:7px;height:7px;border-radius:50%;background:#ff0000;box-shadow:0 0 6px #ff0000;animation:dp2 1.5s infinite;}
@keyframes dp2{0%,100%{opacity:1}50%{opacity:.3}}
#consoleOutput{height:140px;overflow-y:auto;font-size:.8rem;color:#aaa;margin-bottom:10px;line-height:1.85;}
#consoleOutput::-webkit-scrollbar{width:2px;}
#consoleOutput::-webkit-scrollbar-thumb{background:var(--accent);}
#consoleInput{width:100%;padding:10px 13px;background:rgba(0,0,0,.6);border:1px solid rgba(255,0,0,.5);color:#fff;font-family:'JetBrains Mono',monospace;font-size:.8rem;outline:none;transition:box-shadow .3s;}
#consoleInput:focus{box-shadow:0 0 16px rgba(255,0,0,.35);border-color:#ff0000;}

/* ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ */
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;backdrop-filter:blur(10px);background:rgba(0,0,0,.72);z-index:100;}
.modal.open{display:flex;}
.modal__box{width:560px;max-width:90vw;background:#080808;border:2px solid var(--accent);padding:36px;animation:mi .35s cubic-bezier(.34,1.56,.64,1);}
@keyframes mi{from{transform:translateY(40px) scale(.95);opacity:0}to{transform:translateY(0) scale(1);opacity:1}}
.modal__title{color:var(--accent);margin-bottom:16px;font-size:1rem;letter-spacing:1px;}
.modal__text{color:#ccc;margin-bottom:24px;line-height:1.7;font-size:.85rem;}

/* glitch */
@keyframes gkd{0%{transform:translate(0)}20%{transform:translate(-4px,2px);filter:hue-rotate(90deg)}40%{transform:translate(4px,-2px)}60%{transform:translate(-2px,3px);filter:hue-rotate(0)}80%{transform:translate(2px,-1px)}100%{transform:translate(0)}}
.glitch-active{animation:gkd .4s ease !important;}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SCAN PAGE STYLES
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
#scanPage{--accent:#ff0000;--glass:#0e0404ec;--muted:rgba(255,255,255,.55);--border:1px solid rgba(255,0,0,.22);}
#bgcScan{position:fixed;inset:0;z-index:0;pointer-events:none;}
.swrap{position:relative;z-index:1;max-width:1200px;margin:0 auto;padding:36px 32px 80px;}
.shdr{border-bottom:2px solid var(--accent);padding-bottom:16px;margin-bottom:28px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:12px;}
.shdr-left h1{font-size:1.7rem;font-weight:800;letter-spacing:-1px;}
.shdr-left p{color:var(--accent);font-size:.72rem;letter-spacing:3px;margin-top:4px;}
.back-btn{background:transparent;border:2px solid rgba(255,0,0,.4);padding:9px 18px;font-family:'JetBrains Mono',monospace;font-weight:800;font-size:.7rem;color:var(--text-muted);text-transform:uppercase;cursor:pointer;transition:all .2s;flex-shrink:0;}
.back-btn:hover{border-color:var(--accent);color:#fff;background:rgba(255,0,0,.1);}
.sgrid{display:grid;grid-template-columns:1fr 1fr;gap:22px;margin-bottom:26px;}
.spanel{background:var(--glass);border:var(--border);padding:20px;backdrop-filter:blur(20px);position:relative;}
.spanel::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,var(--accent),transparent);opacity:.5;}
.panel-title{color:var(--accent);font-size:.7rem;letter-spacing:2px;margin-bottom:13px;display:flex;align-items:center;gap:7px;}
.sdot{width:6px;height:6px;border-radius:50%;background:var(--accent);box-shadow:0 0 6px var(--accent);animation:dp 1.5s infinite;}
@keyframes dp{0%,100%{opacity:1}50%{opacity:.2}}
.zone{width:100%;aspect-ratio:4/3;border:2px dashed rgba(255,0,0,.3);display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;position:relative;overflow:hidden;background:rgba(255,0,0,.02);transition:all .3s;}
.zone:hover{border-color:var(--accent);background:rgba(255,0,0,.05);}
.zone.has{border:2px solid var(--accent);cursor:default;}
.zone.cam{border:2px solid #00ff88;}
.zone-ico{font-size:2.5rem;opacity:.3;margin-bottom:10px;pointer-events:none;}
.zone-txt{color:var(--muted);font-size:.7rem;text-align:center;line-height:1.7;pointer-events:none;}
#vid{display:none;position:absolute;inset:0;width:100%;height:100%;object-fit:cover;}
#prev{display:none;position:absolute;inset:0;width:100%;height:100%;object-fit:contain;background:#000;}
.beam{position:absolute;left:0;top:-3px;width:100%;height:3px;background:linear-gradient(90deg,transparent,#ff0000,transparent);box-shadow:0 0 16px #ff0000;display:none;z-index:5;animation:bm 1.2s ease-in-out infinite;}
.zone.scanning .beam{display:block;}
@keyframes bm{0%{top:-3px;opacity:0}10%{opacity:1}90%{opacity:1}100%{top:calc(100% + 3px);opacity:0}}
.zbadge{position:absolute;top:8px;left:8px;z-index:6;background:rgba(0,0,0,.85);border:1px solid var(--accent);padding:3px 9px;font-size:.6rem;color:var(--accent);letter-spacing:1px;display:none;}
.zone.has .zbadge,.zone.cam .zbadge{display:block;}
.sbtns{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap;}
.sbtn{flex:1;background:transparent;border:2px solid var(--accent);padding:10px 12px;font-family:'JetBrains Mono',monospace;font-weight:800;font-size:.68rem;color:#fff;text-transform:uppercase;cursor:pointer;transition:all .2s;text-align:center;}
.sbtn:hover{background:var(--accent);color:#000;}
.sbtn:active{transform:scale(.96);}
.sbtn.sec{border-color:rgba(255,255,255,.2);color:var(--muted);}
.sbtn.sec:hover{background:rgba(255,255,255,.08);color:#fff;}
.sbtn.big{width:100%;flex:unset;margin-top:10px;font-size:.76rem;padding:13px;}
.sbtn.big:disabled{opacity:.35;pointer-events:none;}
.sbtn.go{animation:spulse 1.5s infinite;}
@keyframes spulse{0%,100%{box-shadow:0 0 0 rgba(255,0,0,0)}50%{box-shadow:0 0 20px rgba(255,0,0,.5)}}
.prog{margin-top:10px;display:none;}
.prog.on{display:block;}
.ptrack{height:3px;background:rgba(255,0,0,.1);}
.pfill{height:100%;width:0;background:linear-gradient(90deg,#ff0000,#ff6600);box-shadow:0 0 8px #ff0000;transition:width .25s;}
.plbl{font-size:.62rem;color:rgba(255,0,0,.6);margin-top:5px;letter-spacing:1px;}
.slog{background:#000;border:1px solid rgba(255,0,0,.2);min-height:210px;max-height:320px;overflow-y:auto;padding:13px;font-size:.7rem;line-height:1.9;}
.slog::-webkit-scrollbar{width:2px;}
.slog::-webkit-scrollbar-thumb{background:var(--accent);}
.sl{color:rgba(255,255,255,.45);}
.sl.r{color:var(--accent);}
.sl.g{color:#00ff88;}
.sl.o{color:#ff8800;}
.sl.e{color:#ff4444;}
.sl.d{color:rgba(255,0,0,.2);}
.mchip{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;font-size:.62rem;border:1px solid rgba(255,0,0,.3);color:rgba(255,0,0,.6);margin-bottom:12px;}
.mchip.ok{border-color:#00ff88;color:#00ff88;}
.mchip span{width:6px;height:6px;border-radius:50%;background:currentColor;animation:dp 1.5s infinite;}
/* AR section */
#arSection{display:none;margin-bottom:22px;}
#arSection.on{display:block;}
.ar-wrap{position:relative;width:100%;background:#000;}
#arBigImg{width:100%;display:block;object-fit:contain;max-height:500px;}
#arBigCanvas{position:absolute;top:0;left:0;width:100%;height:100%;z-index:10;}
.ar-label-panel{background:rgba(0,0,0,.95);border-top:1px solid rgba(0,255,136,.2);padding:13px 18px;display:flex;flex-wrap:wrap;gap:10px;align-items:center;}
.ar-chip{display:flex;align-items:center;gap:7px;padding:5px 11px;border:1px solid;font-size:.64rem;font-weight:800;letter-spacing:1px;cursor:pointer;transition:all .2s;}
.ar-chip:hover{opacity:.7;}
.ar-chip.hi{border-color:#ff3333;color:#ff3333;}
.ar-chip.med{border-color:#ff8800;color:#ff8800;}
.ar-chip.lo{border-color:#00ff88;color:#00ff88;}
.ar-chip.active{background:currentColor;color:#000;}
.ar-chip .cdot{width:8px;height:8px;border-radius:50%;background:currentColor;flex-shrink:0;}
.ar-instr{background:rgba(0,0,0,.92);border:1px solid rgba(0,255,136,.3);padding:12px 16px;margin:0;font-size:.72rem;line-height:1.7;color:rgba(255,255,255,.8);display:none;border-top:1px solid rgba(0,255,136,.15);}
.ar-instr strong{color:#00ff88;}
/* results */
#sresults{display:none;}
#sresults.on{display:block;}
.devbar{display:flex;align-items:center;justify-content:space-between;background:rgba(255,0,0,.07);border:1px solid rgba(255,0,0,.3);padding:15px 18px;margin-bottom:18px;flex-wrap:wrap;gap:10px;}
.devbar h2{font-size:1.05rem;font-weight:800;}
.devtype{padding:4px 12px;border:1px solid var(--accent);color:var(--accent);font-size:.68rem;font-weight:800;letter-spacing:1px;}
.cchip{padding:4px 11px;font-size:.66rem;font-weight:800;letter-spacing:1px;border:1px solid rgba(255,0,0,.3);color:var(--muted);}
.cchip.g{border-color:#00ff88;color:#00ff88;}.cchip.o{border-color:#ff8800;color:#ff8800;}.cchip.r{border-color:#ff0000;color:#ff0000;}
.dtable{width:100%;border-collapse:collapse;margin-bottom:20px;}
.dtable th{color:var(--accent);font-size:.63rem;letter-spacing:2px;padding:7px 11px;text-align:left;border-bottom:1px solid rgba(255,0,0,.2);}
.dtable td{padding:9px 11px;font-size:.74rem;border-bottom:1px solid rgba(255,0,0,.07);vertical-align:top;}
.dtable tr:hover td{background:rgba(255,0,0,.04);}
.stag{display:inline-block;padding:2px 8px;font-size:.6rem;font-weight:800;letter-spacing:1px;border:1px solid currentColor;}
.stag.ok{color:#00ff88;}.stag.worn{color:#ff8800;}.stag.dmg{color:#ff3333;}.stag.unk{color:rgba(255,255,255,.4);}
.ptag{display:inline-block;padding:2px 8px;font-size:.6rem;font-weight:800;letter-spacing:1px;border:1px solid currentColor;}
.ptag.lo{color:#00ff88;}.ptag.med{color:#ff8800;}.ptag.hi{color:#ff3333;}
.ssteps{display:flex;flex-direction:column;gap:9px;margin-bottom:20px;}
.sstep{display:flex;gap:13px;padding:13px;background:rgba(255,0,0,.04);border:1px solid rgba(255,0,0,.1);}
.sstep:hover{border-color:rgba(255,0,0,.4);}
.snum{width:26px;height:26px;border-radius:50%;border:2px solid var(--accent);color:var(--accent);font-size:.7rem;font-weight:800;display:flex;align-items:center;justify-content:center;flex-shrink:0;}
.sbody strong{color:#fff;font-size:.78rem;display:block;margin-bottom:3px;}
.sbody p{color:var(--muted);font-size:.74rem;line-height:1.6;}
.tools-row{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:20px;}
.tool{padding:4px 11px;background:rgba(255,0,0,.06);border:1px solid rgba(255,0,0,.2);font-size:.68rem;color:var(--muted);}
.rcard{background:rgba(5,0,0,.97);border:2px solid var(--accent);padding:26px;position:relative;overflow:hidden;margin-top:22px;}
.rcard::after{content:'';position:absolute;top:0;left:0;width:100%;height:2px;background:linear-gradient(90deg,transparent,var(--accent),transparent);animation:sl2 3s linear infinite;}
@keyframes sl2{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}
.rstats{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:18px;}
.rstat{padding:11px;background:rgba(255,0,0,.05);border:1px solid rgba(255,0,0,.12);text-align:center;}
.rstat-v{font-size:1.15rem;font-weight:800;color:var(--accent);display:block;}
.rstat-l{font-size:.58rem;color:var(--muted);letter-spacing:1px;margin-top:2px;}
@keyframes glk{0%{transform:translate(0)}20%{transform:translate(-3px,2px);filter:hue-rotate(90deg)}40%{transform:translate(3px,-2px)}60%{transform:translate(-2px,3px);filter:hue-rotate(0)}80%{transform:translate(2px,-1px)}100%{transform:translate(0)}}
.sglitch{animation:glk .3s;}
.ssp{display:inline-block;width:12px;height:12px;border:2px solid rgba(255,0,0,.2);border-top-color:var(--accent);border-radius:50%;animation:sspin .6s linear infinite;vertical-align:middle;margin-right:5px;}
@keyframes sspin{to{transform:rotate(360deg)}}
#sfinput{display:none;}
@media(max-width:700px){.sgrid{grid-template-columns:1fr;}.rstats{grid-template-columns:1fr 1fr;}.dashboard-grid{grid-template-columns:1fr;}}
</style>
</head>
<body>

<!-- PAGE TRANSITION -->
<div id="transition"></div>

<!-- BACKGROUNDS (always visible) -->
<div class="energy-layer"></div>
<div class="cursor-glow" id="cursorGlow"></div>
<canvas id="bgCanvas"></canvas>
<!-- Scan page bg -->
<canvas id="bgcScan" style="display:none;"></canvas>

<!-- MENU TOGGLE -->
<button id="menuToggle" title="Toggle Sidebar">‚ò∞</button>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     DASHBOARD PAGE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page active" id="dashPage">
 <div class="app">
  <aside class="sidebar" id="sidebar">
    <div class="sidebar__logo">ARCHAIN</div>
    <nav class="sidebar__nav">
      <div class="nav-item" data-key="live">‚ö° LIVE_TELEMETRY</div>
      <div class="nav-item" data-key="blocks">üõ° PROOF_VAULT</div>
      <div class="nav-item" data-key="anomalies">üêõ ANOMALY_LOGS</div>
      <div class="nav-item" id="walletConnect">üí≥ CONNECT WALLET</div>
    </nav>
    <div class="sidebar__footer">
      <button class="btn sec" id="themeBtn">‚óë TOGGLE THEME</button>
    </div>
  </aside>

  <main class="main">
    <section class="hero">
      <h1 class="hero__title">ARCHAIN SYSTEM INTERFACE</h1>
      <p class="hero__subtitle">‚ñ∏ DECENTRALIZED PROOF-OF-SERVICE PROTOCOL</p>
      <div class="pulse-bar">
        <div id="pulseIndicator"></div>
        <span>SYNC ACTIVE ‚Äî NODE #0xA3F7</span>
      </div>
    </section>

    <section class="dashboard-grid">
      <!-- SYSTEM DIAGNOSTIC ‚Üí links to scan page -->
      <div class="card">
        <h3 class="card__title">SYSTEM DIAGNOSTIC</h3>
        <div class="card-holo-wrap"><canvas class="mini-holo" data-shape="tetra"></canvas></div>
        <p class="card__text">AI-driven fraud detection active. All integrity checks nominal.</p>
        <button class="btn" id="initBtn" onclick="goToScan()">‚ñ∏ INITIALIZE</button>
      </div>

      <div class="card">
        <h3 class="card__title">AR VERIFICATION</h3>
        <div class="card-holo-wrap"><canvas class="mini-holo" data-shape="octa"></canvas></div>
        <p class="card__text">Visual repair proof sync enabled. Blockchain anchor confirmed.</p>
        <button class="btn" data-key="ar">‚ñ∏ VERIFY</button>
      </div>

      <div class="card">
        <h3 class="card__title">IOT TELEMETRY</h3>
        <div class="card-holo-wrap"><canvas class="mini-holo" data-shape="torus"></canvas></div>
        <p class="card__text">Real-time vibration &amp; thermal monitoring across all nodes.</p>
        <button class="btn" data-key="iot">‚ñ∏ LINK NODE</button>
      </div>
    </section>

    <div class="holo-section">
      <div class="holo-label">‚ñ∏ HOLOGRAPHIC PROTOCOL VISUALIZER</div>
      <div class="holo-stats" id="holoStats">RENDER: 60fps<br>POLY: 12,480<br>SYNC: LIVE</div>
      <canvas id="holoCanvas"></canvas>
    </div>

    <div class="telemetry-panel">
      <h3>‚óà LIVE SENSOR STREAM</h3>
      <div id="sensorData">Temperature: ‚Äî ¬∞C<br>Vibration: ‚Äî Hz</div>
      <div id="sensorStatus" class="sensor-status normal">‚óè NORMAL</div>
      <canvas id="sensorChart"></canvas>
    </div>

    <div class="ai-console">
      <div class="console-header"><div class="console-dot"></div>‚ñ∏ NEURAL COMMAND INTERFACE</div>
      <div id="consoleOutput">
        <div style="color:#ff0000">> ARCHAIN OS v3.0.0 ‚Äî SOVEREIGN EDITION</div>
        <div>> Neural link established. Awaiting input...</div>
        <div>> Type <span style="color:rgba(255,0,0,.7)">help</span> for commands | Type <span style="color:rgba(255,0,0,.7)">scan</span> to open AI scanner</div>
      </div>
      <input type="text" id="consoleInput" placeholder="> Enter command..." autocomplete="off" spellcheck="false">
    </div>
  </main>
 </div>
</div>

<!-- MODAL -->
<div class="modal" id="modal">
  <div class="modal__box">
    <h2 class="modal__title" id="modalTitle"></h2>
    <p class="modal__text" id="modalText"></p>
    <button class="btn" id="closeModal">‚úï TERMINATE LINK</button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     AI SCAN PAGE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="scanPage">
<div class="swrap">
  <div class="shdr">
    <div class="shdr-left">
      <h1>AI SCAN &amp; REPAIR MODULE</h1>
      <p>‚ñ∏ NEURAL VISION ‚Äî AR OVERLAY &amp; DEVICE DAMAGE ANALYSIS</p>
    </div>
    <button class="back-btn" onclick="goToDash()">‚óÄ BACK TO DASHBOARD</button>
  </div>

  <div class="sgrid">
    <div class="spanel">
      <div class="panel-title"><div class="sdot"></div>INPUT FEED</div>
      <div class="zone" id="zone" onclick="zclick()">
        <div class="beam"></div>
        <div class="zbadge" id="zbadge">‚ñ∏ LOADED</div>
        <div class="zone-ico" id="zico">‚¨°</div>
        <div class="zone-txt" id="ztxt">CLICK TO UPLOAD IMAGE<br><span style="opacity:.5">or use camera below</span></div>
        <video id="vid" autoplay playsinline muted></video>
        <img id="prev" alt="">
      </div>
      <input type="file" id="sfinput" accept="image/*">
      <div class="sbtns">
        <button class="sbtn sec" id="camBtn" onclick="toggleCam()">üì∑ CAMERA</button>
        <button class="sbtn sec" id="capBtn" onclick="capture()" style="display:none">‚óâ CAPTURE</button>
        <button class="sbtn sec" onclick="document.getElementById('sfinput').click()">‚¨Ü UPLOAD</button>
        <button class="sbtn sec" onclick="clearScan()">‚úï CLEAR</button>
      </div>
      <button class="sbtn big go" id="scanBtn" onclick="runScan()" disabled>‚ñ∏ SCAN DEVICE</button>
      <div class="prog" id="prog">
        <div class="ptrack"><div class="pfill" id="pfill"></div></div>
        <div class="plbl" id="plbl">LOADING...</div>
      </div>
    </div>
    <div class="spanel" style="display:flex;flex-direction:column;">
      <div class="panel-title"><div class="sdot"></div>NEURAL CONSOLE</div>
      <div class="mchip" id="mchip"><span></span>LOADING AI MODEL...</div>
      <div class="slog" id="slog">
        <div class="sl r">&gt; ARCHAIN VISION ENGINE v4.0 ‚Äî AR EDITION</div>
        <div class="sl">&gt; Loading TensorFlow AI model...</div>
        <div class="sl">&gt; Works offline ‚Äî no API key needed.</div>
        <div class="sl d">‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</div>
      </div>
    </div>
  </div>

  <div id="arSection">
    <div class="spanel" style="padding:0;border-color:rgba(0,255,136,.3);">
      <div style="padding:13px 18px;border-bottom:1px solid rgba(0,255,136,.15);display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px;">
        <div class="panel-title" style="margin-bottom:0;color:#00ff88;"><div class="sdot" style="background:#00ff88;box-shadow:0 0 6px #00ff88"></div>AR COMPONENT OVERLAY</div>
        <div style="display:flex;gap:8px;flex-wrap:wrap;" id="arChipBar"></div>
      </div>
      <div class="ar-wrap">
        <img id="arBigImg" alt="">
        <canvas id="arBigCanvas"></canvas>
      </div>
      <div class="ar-label-panel" id="arLabelPanel">
        <span style="font-size:.62rem;color:rgba(0,255,136,.5);letter-spacing:2px;">TAP A COMPONENT TO SEE REPAIR GUIDE ‚ñ∏</span>
      </div>
      <div id="arInstruction" class="ar-instr"></div>
    </div>
  </div>

  <div id="sresults">
    <div class="devbar">
      <h2 id="devname">‚Äî</h2>
      <div class="devtype" id="devtype">‚Äî</div>
    </div>
    <div style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:18px;" id="condstrip"></div>
    <div class="spanel" style="margin-bottom:18px;padding:0;">
      <div style="padding:14px 18px;border-bottom:1px solid rgba(255,0,0,.15);">
        <div class="panel-title" style="margin-bottom:0;"><div class="sdot"></div>COMPONENT CONDITION ANALYSIS</div>
      </div>
      <table class="dtable"><thead><tr><th>COMPONENT</th><th>OBSERVATION</th><th>STATUS</th><th>PRIORITY</th></tr></thead><tbody id="dtbody"></tbody></table>
    </div>
    <div class="spanel" style="margin-bottom:18px;">
      <div class="panel-title"><div class="sdot"></div>TOOLS REQUIRED</div>
      <div class="tools-row" id="toolsrow"></div>
    </div>
    <div class="spanel" style="margin-bottom:18px;">
      <div class="panel-title"><div class="sdot"></div>REPAIR GUIDE</div>
      <div class="ssteps" id="stepswrap"></div>
    </div>
    <div style="display:flex;gap:12px;flex-wrap:wrap;">
      <button class="sbtn" style="flex:1;min-width:140px;" onclick="buildReport()">‚¨õ GENERATE REPORT</button>
      <button class="sbtn sec" style="flex:1;min-width:140px;" onclick="clearScan()">‚úï NEW SCAN</button>
    </div>
    <div id="sreport" style="display:none;margin-top:22px;">
      <div class="rcard">
        <div style="display:flex;justify-content:space-between;flex-wrap:wrap;gap:10px;margin-bottom:18px;padding-bottom:14px;border-bottom:1px solid rgba(255,0,0,.25);">
          <div><h2 style="font-size:.95rem;font-weight:800;">ARCHAIN REPAIR REPORT</h2><p style="color:var(--accent);font-size:.63rem;letter-spacing:2px;margin-top:4px;">‚ñ∏ PROOF-OF-SERVICE CERTIFICATE</p></div>
          <div style="text-align:right;font-size:.63rem;color:var(--muted);line-height:1.9;" id="rmeta">‚Äî</div>
        </div>
        <div class="rstats">
          <div class="rstat"><span class="rstat-v" id="rs1">‚Äî</span><div class="rstat-l">Device</div></div>
          <div class="rstat"><span class="rstat-v" id="rs2">‚Äî</span><div class="rstat-l">Components</div></div>
          <div class="rstat"><span class="rstat-v" id="rs3">‚Äî</span><div class="rstat-l">Issues</div></div>
          <div class="rstat"><span class="rstat-v" id="rs4">‚Äî</span><div class="rstat-l">Steps</div></div>
        </div>
        <div id="rfull"></div>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:16px;padding-top:12px;border-top:1px solid rgba(255,0,0,.18);">
          <div style="font-size:.62rem;color:rgba(255,0,0,.4);" id="rhash">‚Äî</div>
          <div style="padding:4px 11px;border:1px solid #00ff88;color:#00ff88;font-size:.62rem;font-weight:800;letter-spacing:1px;">‚óè VERIFIED</div>
        </div>
      </div>
    </div>
  </div>
</div>
</div>

<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   PAGE NAVIGATION
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function goToScan(){
  const t=document.getElementById('transition');
  t.classList.add('show');
  setTimeout(()=>{
    document.getElementById('dashPage').classList.remove('active');
    document.getElementById('scanPage').classList.add('active');
    document.getElementById('bgCanvas').style.display='none';
    document.getElementById('bgcScan').style.display='block';
    document.getElementById('menuToggle').style.display='none';
    initScanBg();
    t.classList.remove('show');
    if(!tfModel)loadModel();
    slog('‚ñ∏ Navigated from Dashboard ‚Äî AI scan ready.','r');
  },380);
}

function goToDash(){
  const t=document.getElementById('transition');
  t.classList.add('show');
  setTimeout(()=>{
    document.getElementById('scanPage').classList.remove('active');
    document.getElementById('dashPage').classList.add('active');
    document.getElementById('bgCanvas').style.display='block';
    document.getElementById('bgcScan').style.display='none';
    document.getElementById('menuToggle').style.display='block';
    stopCam();
    t.classList.remove('show');
  },380);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   DASHBOARD: THREE.JS BG PARTICLES
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let mouseX=0,mouseY=0;
(()=>{
  const canvas=document.getElementById('bgCanvas');
  const renderer=new THREE.WebGLRenderer({canvas,alpha:true});
  renderer.setSize(innerWidth,innerHeight);
  const scene=new THREE.Scene(),cam=new THREE.PerspectiveCamera(75,innerWidth/innerHeight,.1,1000);
  cam.position.z=5;
  const geo=new THREE.BufferGeometry();
  const v=[];for(let i=0;i<2200;i++){v.push((Math.random()-.5)*20,(Math.random()-.5)*20,(Math.random()-.5)*20);}
  geo.setAttribute('position',new THREE.Float32BufferAttribute(v,3));
  const pts=new THREE.Points(geo,new THREE.PointsMaterial({color:0xff0000,size:.05,transparent:true,opacity:.6}));
  scene.add(pts);
  let ry=0,rx=0;
  (function t(){requestAnimationFrame(t);ry+=.0006+Math.abs((mouseX/innerWidth-.5))*.005;rx+=.0003;pts.rotation.y+=(ry-pts.rotation.y)*.05;pts.rotation.x+=(rx-pts.rotation.x)*.05;renderer.render(scene,cam);})();
  window.addEventListener('resize',()=>{renderer.setSize(innerWidth,innerHeight);cam.aspect=innerWidth/innerHeight;cam.updateProjectionMatrix();});
})();

window.addEventListener('mousemove',e=>{
  mouseX=e.clientX;mouseY=e.clientY;
  document.getElementById('cursorGlow').style.left=e.clientX+'px';
  document.getElementById('cursorGlow').style.top=e.clientY+'px';
});

/* MINI HOLOS */
document.querySelectorAll('.mini-holo').forEach(canvas=>{
  const shape=canvas.dataset.shape;
  const r=new THREE.WebGLRenderer({canvas,alpha:true,antialias:true});
  const w=canvas.parentElement.clientWidth||200,h=110;
  r.setSize(w,h);
  const sc=new THREE.Scene(),cam=new THREE.PerspectiveCamera(60,w/h,.1,100);
  cam.position.z=3;
  let geo;
  if(shape==='tetra')geo=new THREE.TetrahedronGeometry(1.2,0);
  else if(shape==='octa')geo=new THREE.OctahedronGeometry(1.1,0);
  else geo=new THREE.TorusGeometry(.9,.35,12,36);
  const mesh=new THREE.Mesh(geo,new THREE.MeshBasicMaterial({color:0xff0000,wireframe:true}));
  sc.add(mesh);
  (function loop(){requestAnimationFrame(loop);mesh.rotation.x+=.008;mesh.rotation.y+=.013;r.render(sc,cam);})();
});

/* HOLO TORUS KNOT */
(()=>{
  const c=document.getElementById('holoCanvas');
  requestAnimationFrame(()=>{
    const w=c.clientWidth||700,h=c.clientHeight||380;
    const r=new THREE.WebGLRenderer({canvas:c,alpha:true,antialias:true});
    r.setSize(w,h);
    const sc=new THREE.Scene(),cam=new THREE.PerspectiveCamera(70,w/h,.1,1000);
    cam.position.z=6;
    const mat=new THREE.MeshBasicMaterial({color:0xff0000,wireframe:true});
    const mesh=new THREE.Mesh(new THREE.TorusKnotGeometry(2,.5,120,18),mat);
    sc.add(mesh);
    let fc=0;
    (function a(){requestAnimationFrame(a);mesh.rotation.x+=.007;mesh.rotation.y+=.010;fc++;if(fc%60===0)document.getElementById('holoStats').innerHTML=`RENDER: ${Math.round(Math.random()*5+57)}fps<br>POLY: 12,480<br>SYNC: LIVE`;r.render(sc,cam);})();
  });
})();

/* CURSOR GLOW */
const cursorGlow=document.getElementById('cursorGlow');

/* SIDEBAR */
document.getElementById('menuToggle').addEventListener('click',()=>{
  const sb=document.getElementById('sidebar');
  sb.classList.toggle('collapsed');
  document.getElementById('menuToggle').textContent=sb.classList.contains('collapsed')?'‚ñ∂':'‚ò∞';
});

/* SENSOR CHART */
const sCtx=document.getElementById('sensorChart').getContext('2d');
const sChart=new Chart(sCtx,{type:'line',data:{labels:[],datasets:[{label:'Temp (¬∞C)',data:[],borderColor:'#ff0000',backgroundColor:'rgba(255,0,0,.07)',tension:.4,fill:true,pointRadius:2},{label:'Vibration (Hz)',data:[],borderColor:'rgba(255,140,0,.85)',backgroundColor:'rgba(255,140,0,.04)',tension:.4,fill:true,pointRadius:2}]},options:{responsive:true,animation:false,plugins:{legend:{labels:{color:'rgba(255,255,255,.5)',font:{family:'JetBrains Mono',size:10}}}},scales:{x:{ticks:{color:'rgba(255,255,255,.4)',font:{family:'JetBrains Mono',size:9}},grid:{color:'rgba(255,0,0,.06)'}},y:{ticks:{color:'rgba(255,255,255,.4)',font:{family:'JetBrains Mono',size:9}},grid:{color:'rgba(255,0,0,.06)'}}}}});
let lastTemp=25;
function simSensor(){
  const temp=parseFloat((20+Math.random()*26).toFixed(2));
  const vib=parseFloat((Math.random()*5.8).toFixed(2));
  lastTemp=temp;
  const danger=temp>40||vib>4;
  document.getElementById('sensorData').innerHTML=`Temperature: <strong>${temp}¬∞C</strong><br>Vibration: <strong>${vib} Hz</strong>`;
  const se=document.getElementById('sensorStatus');
  se.textContent=danger?'‚ö† WARNING':'‚óè NORMAL';
  se.className='sensor-status '+(danger?'warning':'normal');
  const pi=document.getElementById('pulseIndicator');
  pi.style.background=danger?'#ff0000':'#00ff88';
  pi.style.boxShadow=`0 0 8px ${danger?'#ff0000':'#00ff88'}`;
  const now=new Date().toLocaleTimeString();
  sChart.data.labels.push(now);
  sChart.data.datasets[0].data.push(temp);
  sChart.data.datasets[1].data.push(vib);
  if(sChart.data.labels.length>14){sChart.data.labels.shift();sChart.data.datasets[0].data.shift();sChart.data.datasets[1].data.shift();}
  sChart.update();
}
simSensor();setInterval(simSensor,2000);

/* MODAL */
const modalData={
  live:'Real-time telemetry streams are active. All sensor nodes broadcasting on secure encrypted channel. Latency: 4ms.',
  blocks:'Ethereum Testnet proof verification is online. Last block anchored: #7,482,901.',
  anomalies:'AI anomaly detection scanning all logs. Zero critical threats detected this session.',
  ar:'AR visual proof synchronized with blockchain. Repair hashes are immutable. AR overlay nodes: ONLINE.',
  iot:'IoT node successfully linked. Streaming at 2s intervals. MQTT broker: CONNECTED.'
};
document.querySelectorAll('[data-key]').forEach(el=>{
  el.addEventListener('click',()=>{
    const key=el.dataset.key;
    if(!key)return;
    document.getElementById('modalTitle').innerText=key.toUpperCase()+'_PROTOCOL';
    document.getElementById('modalText').innerText=modalData[key]||'Protocol active.';
    document.getElementById('modal').classList.add('open');
  });
});
document.getElementById('closeModal').addEventListener('click',()=>document.getElementById('modal').classList.remove('open'));
document.getElementById('modal').addEventListener('click',e=>{if(e.target===document.getElementById('modal'))document.getElementById('modal').classList.remove('open');});

/* WALLET */
document.getElementById('walletConnect').addEventListener('click',async()=>{
  if(window.ethereum){try{const a=await window.ethereum.request({method:'eth_requestAccounts'});document.getElementById('modalTitle').innerText='WALLET_CONNECTED';document.getElementById('modalText').innerText=`Address: ${a[0]}`;document.getElementById('modal').classList.add('open');}catch{}}
  else{document.getElementById('modalTitle').innerText='METAMASK_NOT_DETECTED';document.getElementById('modalText').innerText='MetaMask is not installed. Visit metamask.io.';document.getElementById('modal').classList.add('open');}
});

/* THEME */
const themes=[{c:0xff0000,hex:'#ff0000'},{c:0x00ffff,hex:'#00ffff'},{c:0xaa00ff,hex:'#aa00ff'},{c:0x00ff88,hex:'#00ff88'}];
let ti=0;
document.getElementById('themeBtn').addEventListener('click',()=>{
  ti=(ti+1)%themes.length;
  document.documentElement.style.setProperty('--accent',themes[ti].hex);
  typeConsole(`‚ñ∏ THEME: ${themes[ti].hex}`,themes[ti].hex);
});

/* CONSOLE */
const cout=document.getElementById('consoleOutput'),cin=document.getElementById('consoleInput');
const cmds={
  status:[{t:'‚ñ∏ SYSTEM: SOVEREIGN',c:'#ff8800'},{t:'  Node Mesh: ONLINE [7/7]',c:'#fff'},{t:'  Threat Level: ZERO',c:'#00ff88'}],
  scan:[{t:'‚ñ∏ Opening AI Scanner...',c:'#ff8800'}],
  hash:[{t:'‚ñ∏ GENERATING HASH...',c:'#ff8800'},{t:`  Hash: ${Math.random().toString(16).slice(2,18)}`,c:'#fff'},{t:'  ‚úì Anchored.',c:'#00ff88'}],
  nodes:[{t:'‚ñ∏ NODE REGISTRY:',c:'#ff8800'},{t:'  [NODE-1] 0xA3F7 ‚Äî ONLINE',c:'#00ff88'},{t:'  [NODE-2] 0xB8C2 ‚Äî ONLINE',c:'#00ff88'}],
  help:[{t:'‚ñ∏ COMMANDS: status | scan | hash | nodes | clear',c:'#ff0000'}]
};
function typeConsole(text,color){const d=document.createElement('div');d.style.color=color||'#aaa';d.textContent=text;cout.appendChild(d);cout.scrollTop=cout.scrollHeight;}
function runCmds(lines,i=0){if(i>=lines.length)return;setTimeout(()=>{typeConsole(lines[i].t,lines[i].c);runCmds(lines,i+1);},i===0?0:160);}
cin.addEventListener('keydown',e=>{
  if(e.key!=='Enter')return;
  const raw=cin.value.trim();if(!raw)return;
  cout.innerHTML+=`<div style="color:#ff0000;margin-top:4px">> ${raw}</div>`;
  cin.value='';
  const cmd=raw.toLowerCase();
  if(cmd==='clear'){cout.innerHTML='';return;}
  if(cmd.includes('scan')){runCmds(cmds.scan);setTimeout(goToScan,600);return;}
  let matched=false;
  for(const[k,v]of Object.entries(cmds)){if(cmd.includes(k)){runCmds(v);matched=true;break;}}
  if(!matched)typeConsole(`Unknown: "${raw}". Type help.`,'#555');
  cout.scrollTop=cout.scrollHeight;
});

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SCAN PAGE BG PARTICLES
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let scanBgInit=false;
function initScanBg(){
  if(scanBgInit)return;scanBgInit=true;
  const c=document.getElementById('bgcScan'),x=c.getContext('2d');
  const resize=()=>{c.width=innerWidth;c.height=innerHeight;};resize();
  window.addEventListener('resize',resize);
  c.style.cssText='position:fixed;inset:0;z-index:0;pointer-events:none;background:radial-gradient(circle at 30% 40%,rgba(255,0,0,.06),transparent 50%),radial-gradient(circle at 70% 70%,rgba(255,0,0,.04),transparent 50%)';
  const pts=Array.from({length:80},()=>({x:Math.random()*innerWidth,y:Math.random()*innerHeight,vx:(Math.random()-.5)*.3,vy:(Math.random()-.5)*.3,r:Math.random()*.9+.2,a:Math.random()*.35+.07}));
  (function t(){requestAnimationFrame(t);x.clearRect(0,0,c.width,c.height);pts.forEach(p=>{p.x+=p.vx;p.y+=p.vy;if(p.x<0)p.x=c.width;if(p.x>c.width)p.x=0;if(p.y<0)p.y=c.height;if(p.y>c.height)p.y=0;x.beginPath();x.arc(p.x,p.y,p.r,0,Math.PI*2);x.fillStyle=`rgba(255,0,0,${p.a})`;x.fill();});})();
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SCAN PAGE LOGIC
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const AR_ZONES={
  cell_phone:[{idx:0,label:'Display',x:.5,y:.38,w:.72,h:.55,color:'#ff3333'},{idx:1,label:'Battery',x:.5,y:.62,w:.55,h:.18,color:'#ff8800'},{idx:2,label:'Charge Port',x:.5,y:.91,w:.16,h:.06,color:'#ff8800'},{idx:3,label:'Camera',x:.73,y:.14,w:.14,h:.12,color:'#ff8800'},{idx:4,label:'Speaker',x:.5,y:.95,w:.22,h:.04,color:'#00ff88'},{idx:5,label:'SIM Tray',x:.96,y:.30,w:.04,h:.10,color:'#00ff88'}],
  laptop:[{idx:0,label:'Fan/Heat',x:.50,y:.70,w:.30,h:.20,color:'#ff8800'},{idx:1,label:'Battery',x:.50,y:.80,w:.60,h:.18,color:'#ff8800'},{idx:2,label:'Keyboard',x:.50,y:.62,w:.80,h:.30,color:'#00ff88'},{idx:3,label:'Storage',x:.30,y:.75,w:.20,h:.14,color:'#00ff88'},{idx:4,label:'RAM',x:.70,y:.75,w:.20,h:.08,color:'#00ff88'},{idx:5,label:'Power Jack',x:.05,y:.50,w:.06,h:.06,color:'#ff8800'},{idx:6,label:'Hinges',x:.50,y:.04,w:.80,h:.06,color:'#00ff88'}],
  keyboard:[{idx:0,label:'Keycaps',x:.50,y:.50,w:.90,h:.75,color:'#ff8800'},{idx:1,label:'Switches',x:.30,y:.50,w:.50,h:.60,color:'#00ff88'},{idx:2,label:'PCB',x:.50,y:.50,w:.90,h:.80,color:'#00ff88'},{idx:3,label:'USB Cable',x:.05,y:.50,w:.08,h:.12,color:'#ff8800'},{idx:4,label:'Stabilizers',x:.20,y:.80,w:.35,h:.15,color:'#ff8800'}],
  mouse:[{idx:0,label:'L-Click',x:.33,y:.22,w:.32,h:.28,color:'#ff8800'},{idx:1,label:'Scroll Enc.',x:.50,y:.38,w:.14,h:.18,color:'#ff8800'},{idx:2,label:'Sensor',x:.50,y:.68,w:.18,h:.10,color:'#00ff88'},{idx:3,label:'USB Cable',x:.50,y:.93,w:.10,h:.08,color:'#00ff88'},{idx:4,label:'Mouse Feet',x:.50,y:.80,w:.70,h:.08,color:'#ff8800'}],
  book:[{idx:0,label:'Display',x:.50,y:.42,w:.82,h:.60,color:'#00ff88'},{idx:1,label:'Battery',x:.50,y:.60,w:.60,h:.18,color:'#ff8800'},{idx:2,label:'Digitizer',x:.50,y:.42,w:.82,h:.60,color:'#00ff88'},{idx:3,label:'Charge Port',x:.04,y:.50,w:.05,h:.06,color:'#ff8800'},{idx:4,label:'Camera',x:.50,y:.05,w:.10,h:.06,color:'#00ff88'}],
  tv:[{idx:0,label:'PSU Board',x:.15,y:.85,w:.25,h:.18,color:'#ff3333'},{idx:1,label:'T-Con Board',x:.50,y:.85,w:.25,h:.18,color:'#ff3333'},{idx:2,label:'LED Backlt',x:.50,y:.45,w:.88,h:.75,color:'#ff8800'},{idx:3,label:'HDMI Ports',x:.88,y:.82,w:.14,h:.14,color:'#00ff88'},{idx:4,label:'Speakers',x:.50,y:.92,w:.60,h:.08,color:'#00ff88'}],
  remote_control:[{idx:0,label:'Batteries',x:.50,y:.70,w:.55,h:.35,color:'#ff8800'},{idx:1,label:'Btn Pads',x:.50,y:.40,w:.65,h:.55,color:'#ff8800'},{idx:2,label:'IR LED',x:.50,y:.04,w:.12,h:.06,color:'#00ff88'},{idx:3,label:'PCB',x:.50,y:.50,w:.60,h:.80,color:'#00ff88'}],
  bottle:[{idx:0,label:'Battery Pk',x:.50,y:.80,w:.55,h:.28,color:'#ff8800'},{idx:1,label:'Motor',x:.50,y:.45,w:.40,h:.40,color:'#ff8800'},{idx:2,label:'Switch',x:.50,y:.22,w:.35,h:.14,color:'#00ff88'},{idx:3,label:'Chuck',x:.50,y:.06,w:.25,h:.08,color:'#00ff88'},{idx:4,label:'Vents',x:.22,y:.45,w:.08,h:.35,color:'#ff8800'}],
  _unknown:[{idx:0,label:'Power Input',x:.50,y:.90,w:.25,h:.10,color:'#ff8800'},{idx:1,label:'Main Board',x:.50,y:.50,w:.70,h:.60,color:'#00ff88'},{idx:2,label:'Connectors',x:.88,y:.55,w:.16,h:.30,color:'#ff8800'},{idx:3,label:'Thermal',x:.50,y:.22,w:.50,h:.20,color:'#00ff88'},{idx:4,label:'Fasteners',x:.15,y:.15,w:.10,h:.10,color:'#00ff88'}]
};
const DB={
  cell_phone:{name:'Smartphone / Mobile Device',type:'SMARTPHONE',condition:'GOOD',components:[{name:'Display / Touchscreen',status:'OK',obs:'Screen surface detected. Check for cracks, dead pixels, or touch dead zones.',priority:'HIGH'},{name:'Battery',status:'WORN',obs:'Batteries degrade with charge cycles. Check for swelling or rapid drain.',priority:'HIGH'},{name:'Charging Port',status:'WORN',obs:'Inspect for lint, bent pins, or corrosion causing intermittent charging.',priority:'HIGH'},{name:'Camera Module',status:'OK',obs:'Camera glass visible. Check for scratches, fog, or autofocus issues.',priority:'MEDIUM'},{name:'Speaker / Earpiece',status:'OK',obs:'Check for muffled output, distortion, or complete silence.',priority:'MEDIUM'},{name:'SIM / MicroSD Tray',status:'OK',obs:'Tray and port area. Inspect for corrosion or ejection issues.',priority:'LOW'}],tools:['Pentalobe/Torx Screwdriver','Plastic Pry Tool','Suction Cup','Heat Gun','Tweezers','ESD Wrist Strap','IPA 90%+'],steps:[{title:'Power Off & Discharge ESD',detail:'Completely power off. Put on ESD wrist strap. Hold power button 10s after shutdown.'},{title:'Soften Adhesive & Open',detail:'Apply heat (45‚Äì50¬∞C) around screen edges 90s. Insert suction cup on bottom, then plastic spudger at corner.'},{title:'Disconnect Battery First',detail:'Locate battery connector on motherboard and disconnect using plastic spudger. Wait 60 seconds.'},{title:'Inspect & Test',detail:'Check charging port for debris/corrosion. Inspect battery for swelling. Test screen touch. Check cameras.'},{title:'Clean & Reassemble',detail:'Clean connectors with IPA. Reconnect flex cables. Apply new adhesive if required. Power on and test.'}]},
  laptop:{name:'Laptop / Notebook Computer',type:'LAPTOP',condition:'FAIR',components:[{name:'Cooling Fan / Heatsink',status:'WORN',obs:'Fans accumulate dust reducing airflow. Likely cause of thermal throttling or shutdown.',priority:'HIGH'},{name:'Battery Pack',status:'WORN',obs:'Li-ion cells degrade. Check cycle count vs rated cycles. Swelling = immediate replacement.',priority:'HIGH'},{name:'Keyboard / Trackpad',status:'OK',obs:'Check for sticky keys, non-responsive keys, or trackpad click issues.',priority:'MEDIUM'},{name:'Storage Drive',status:'OK',obs:'Run SMART diagnostics. Watch for slow boot times or file errors.',priority:'HIGH'},{name:'RAM Modules',status:'OK',obs:'Reseat RAM if experiencing random crashes or BSODs.',priority:'MEDIUM'},{name:'DC Power Jack',status:'WORN',obs:'Inspect for wobble, intermittent charging, or discoloration.',priority:'MEDIUM'},{name:'Display Hinges',status:'OK',obs:'Check hinge tension ‚Äî loose hinges cause cable damage over time.',priority:'LOW'}],tools:['Phillips #0 & #1 Screwdriver','Plastic Spudger Set','Thermal Paste (Arctic MX-4)','Compressed Air Can','Anti-Static Mat','Multimeter','IPA 90%+'],steps:[{title:'Disconnect Power & Battery',detail:'Unplug AC adapter. Remove or disconnect battery. Hold power button 15s.'},{title:'Remove Bottom Panel',detail:'Remove all screws including those hidden under rubber feet. Gently pry edges.'},{title:'Clean Cooling System',detail:'Blast fan vents with compressed air. Remove heatsink, clean old thermal paste, apply fresh pea-sized dot.'},{title:'Check Storage & RAM',detail:'Reseat RAM by unlocking clips and firmly re-inserting at 45¬∞. Check SSD connectors. Run SMART data.'},{title:'Reassemble & Test',detail:'Boot into BIOS and verify fan speed and temperatures. Run stress test for 10 minutes.'}]},
  keyboard:{name:'Keyboard / Input Peripheral',type:'PERIPHERAL',condition:'GOOD',components:[{name:'Keycaps',status:'WORN',obs:'Key legends fade with use. Check for missing, sticky, or rattling keycaps.',priority:'LOW'},{name:'Switches',status:'OK',obs:'Test each switch for actuation. Dead switches need desoldering and replacement.',priority:'HIGH'},{name:'PCB / Controller',status:'OK',obs:'Check for liquid damage indicators or corrosion on PCB traces.',priority:'HIGH'},{name:'USB Cable',status:'WORN',obs:'Cables fray at the connector end ‚Äî source of intermittent drops.',priority:'MEDIUM'},{name:'Stabilizers',status:'WORN',obs:'Spacebar/shift stabilizers need lubrication if rattling or scratchy.',priority:'LOW'}],tools:['Keycap Puller','Switch Puller','Soldering Iron + Solder Wick','Switch Lubricant (Krytox 205g0)','Dielectric Grease','Small Phillips Screwdriver'],steps:[{title:'Remove Keycaps',detail:'Use keycap puller to remove all keycaps. Inspect each for cracks or worn legends. Wash and dry.'},{title:'Test All Switches',detail:'Use VIA/QMK software or keyboard tester website to identify dead or chattering switches.'},{title:'Replace Faulty Switches',detail:'Desolder dead switches using solder wick and iron at 350¬∞C. Install new switches, solder two pins firmly.'},{title:'Lube Stabilizers',detail:'Remove stabilizers, apply dielectric grease on wire contact points, apply Krytox 205g0 to housing.'},{title:'Reassemble & Test',detail:'Reinstall switches and keycaps. Test every key. Check stabilizers for rattle.'}]},
  mouse:{name:'Computer Mouse / Pointing Device',type:'PERIPHERAL',condition:'GOOD',components:[{name:'Main Click Switches',status:'WORN',obs:'Double-clicking when single-clicking is the most common mouse failure ‚Äî switch fatigue.',priority:'HIGH'},{name:'Scroll Wheel Encoder',status:'WORN',obs:'Erratic scrolling or skipping indicates a dirty or failing encoder.',priority:'HIGH'},{name:'Optical/Laser Sensor',status:'OK',obs:'Clean sensor lens with cotton swab. Check mousepad surface for tracking issues.',priority:'MEDIUM'},{name:'USB Cable / Dongle',status:'OK',obs:'Cable kinks near connector cause dropouts.',priority:'MEDIUM'},{name:'Mouse Feet (PTFE)',status:'WORN',obs:'Worn feet increase friction and change glide feel significantly.',priority:'LOW'}],tools:['JIS/Phillips #0 Screwdriver','Hot Air Gun','Soldering Iron','Replacement Switches (Omron D2FC-F-7N)','Replacement Mouse Feet','Isopropyl Alcohol'],steps:[{title:'Disassemble Shell',detail:'Remove all screws (often hidden under mouse feet or labels). Gently separate top and bottom shells.'},{title:'Identify Faulty Switch',detail:'Test main switches with multimeter in continuity mode. A good switch gives a clean click.'},{title:'Replace Main Switches',detail:'Desolder old Omron or Kailh switches. Install new switches, solder cleanly, test before closing.'},{title:'Clean Scroll Encoder',detail:'Spray electronics contact cleaner into scroll encoder while spinning wheel. Let dry 5 minutes.'},{title:'Replace Mouse Feet & Reassemble',detail:'Apply new PTFE feet. Reassemble shell, tighten screws gently. Test all buttons and scroll.'}]},
  _unknown:{name:'Unknown Electronic Device',type:'UNKNOWN',condition:'FAIR',components:[{name:'Power Input / Supply',status:'WORN',obs:'Check power cable, fuse, and input voltage against device rating.',priority:'HIGH'},{name:'Main Circuit Board',status:'OK',obs:'Inspect for burnt components, swollen capacitors, or corrosion.',priority:'HIGH'},{name:'External Connectors',status:'WORN',obs:'Check all ports and connectors for bent pins, debris, or corrosion.',priority:'MEDIUM'},{name:'Thermal Management',status:'OK',obs:'Check heatsinks and vents for dust blockage causing overheating.',priority:'MEDIUM'},{name:'Mechanical Fasteners',status:'OK',obs:'Check for missing screws or cracked housing affecting shielding.',priority:'LOW'}],tools:['Multimeter','Screwdriver Set','Plastic Pry Tools','ESD Wrist Strap','Compressed Air','IPA 90%+'],steps:[{title:'Visual Inspection',detail:'Inspect all external surfaces for physical damage, burn marks, liquid stains, or impact damage.'},{title:'Power Test',detail:'Check power input with multimeter. Verify correct voltage and polarity. Check fuse continuity.'},{title:'Careful Disassembly',detail:'Remove fasteners methodically, bagging screws by location. Photograph cable routing before disconnecting.'},{title:'Component Inspection',detail:'Check electrolytic capacitors for bulging. Look for burnt resistors or cracked ICs.'},{title:'Clean & Reassemble',detail:'Clean PCB with isopropyl alcohol. Fix identified faults. Reassemble and test all functions.'}]}
};
const LABEL_MAP={'cell phone':'cell_phone','laptop':'laptop','keyboard':'keyboard','mouse':'mouse','remote':'remote_control','book':'book','tv':'tv','monitor':'tv','bottle':'bottle','clock':'_unknown','person':'_unknown','chair':'_unknown','couch':'_unknown','default':'_unknown'};

let tfModel=null,stream=null,camOn=false,imgEl=null,scanResult=null,arKey='_unknown',activeZone=null,arAnimFrame=null;

async function loadModel(){
  slog('Loading TF.js + COCO-SSD...','o');
  try{tfModel=await cocoSsd.load();slog('AI model ready. Upload or capture.','g');document.getElementById('mchip').className='mchip ok';document.getElementById('mchip').innerHTML='<span></span>AI MODEL READY';}
  catch(e){slog('Model load failed: '+e.message,'e');document.getElementById('mchip').textContent='‚ö† MODEL LOAD FAILED';}
}

function slog(txt,cls=''){
  const el=document.getElementById('slog');
  const d=document.createElement('div');d.className='sl '+(cls||'');d.textContent='> '+txt;
  el.appendChild(d);el.scrollTop=el.scrollHeight;
}

document.getElementById('sfinput').addEventListener('change',function(e){
  const f=e.target.files[0];if(!f)return;
  const reader=new FileReader();
  reader.onload=ev=>{const img=new Image();img.onload=()=>{imgEl=img;showPrev(img.src);slog('Image loaded: '+f.name,'r');document.getElementById('scanBtn').disabled=false;};img.src=ev.target.result;};
  reader.readAsDataURL(f);
});

function zclick(){if(!imgEl&&!camOn)document.getElementById('sfinput').click();}

function showPrev(src){
  const p=document.getElementById('prev');p.src=src;p.style.display='block';
  document.getElementById('zico').style.display='none';document.getElementById('ztxt').style.display='none';
  document.getElementById('zone').classList.add('has');document.getElementById('zbadge').textContent='‚ñ∏ LOADED';
}

async function toggleCam(){
  if(camOn){stopCam();return;}
  slog('Opening camera...','o');
  const tries=[{video:{facingMode:{ideal:'environment'}},audio:false},{video:true,audio:false}];
  for(const c of tries){try{stream=await navigator.mediaDevices.getUserMedia(c);break;}catch(e){stream=null;}}
  if(!stream){slog('Camera denied. Use Upload instead.','e');return;}
  const v=document.getElementById('vid');v.srcObject=stream;v.style.display='block';
  document.getElementById('prev').style.display='none';document.getElementById('zico').style.display='none';document.getElementById('ztxt').style.display='none';
  camOn=true;const z=document.getElementById('zone');z.classList.remove('has');z.classList.add('cam');
  document.getElementById('zbadge').textContent='‚ñ∏ LIVE';document.getElementById('camBtn').textContent='‚óº STOP';document.getElementById('capBtn').style.display='block';
  slog('Camera live ‚Äî point at device then CAPTURE.','g');
}

function stopCam(){
  if(stream){stream.getTracks().forEach(t=>t.stop());stream=null;}
  document.getElementById('vid').style.display='none';camOn=false;
  document.getElementById('camBtn').textContent='üì∑ CAMERA';document.getElementById('capBtn').style.display='none';
  document.getElementById('zone').classList.remove('cam');
  if(!imgEl){document.getElementById('zico').style.display='block';document.getElementById('ztxt').style.display='block';}
}

function capture(){
  const v=document.getElementById('vid');const tmp=document.createElement('canvas');
  tmp.width=v.videoWidth||1280;tmp.height=v.videoHeight||720;tmp.getContext('2d').drawImage(v,0,0);
  const src=tmp.toDataURL('image/jpeg',.92);const img=new Image();
  img.onload=()=>{imgEl=img;showPrev(src);};img.src=src;stopCam();
  document.getElementById('scanBtn').disabled=false;slog('Frame captured.','g');
}

function clearScan(){
  stopCam();imgEl=null;scanResult=null;activeZone=null;
  document.getElementById('prev').src='';document.getElementById('prev').style.display='none';
  document.getElementById('zico').style.display='block';document.getElementById('ztxt').style.display='block';
  document.getElementById('zone').className='zone';document.getElementById('scanBtn').disabled=true;
  document.getElementById('prog').className='prog';
  document.getElementById('sresults').style.display='none';document.getElementById('sresults').classList.remove('on');
  document.getElementById('sreport').style.display='none';
  document.getElementById('arSection').style.display='none';document.getElementById('arSection').classList.remove('on');
  document.getElementById('sfinput').value='';slog('Cleared. Ready.','r');
}

async function runScan(){
  if(!imgEl){slog('No image loaded.','e');return;}
  const btn=document.getElementById('scanBtn');
  btn.innerHTML='<span class="ssp"></span>SCANNING...';btn.disabled=true;
  document.getElementById('sresults').style.display='none';document.getElementById('arSection').style.display='none';
  document.getElementById('zone').classList.add('scanning');
  const prog=document.getElementById('prog'),fill=document.getElementById('pfill'),lbl=document.getElementById('plbl');
  prog.className='prog on';
  const steps=[[15,'Preprocessing...'],[35,'Running AI detection...'],[55,'Mapping AR zones...'],[78,'Loading database...'],[100,'Analysis complete.']];
  slog('‚ñ∏ Starting AR scan...','r');
  let detected=null,confidence=0;
  const tfP=(async()=>{
    try{if(!tfModel)throw new Error('Model not loaded yet');
    const preds=await tfModel.detect(imgEl);
    if(preds&&preds.length>0){preds.sort((a,b)=>b.score-a.score);detected=preds[0].class.toLowerCase();confidence=Math.round(preds[0].score*100);slog('Detected: '+preds[0].class+' ('+confidence+'%)','g');}
    else slog('No object detected ‚Äî using general protocol.','o');}
    catch(e){slog('Detection: '+e.message,'e');}
  })();
  const animP=(async()=>{
    for(const[p,t]of steps){await sleep(200+Math.random()*150);fill.style.width=p+'%';lbl.textContent=t;if(p<100)slog(t);}
  })();
  await Promise.all([tfP,animP]);
  document.getElementById('zone').classList.remove('scanning');
  btn.innerHTML='‚ñ∏ SCAN DEVICE';btn.disabled=false;prog.className='prog';
  const key=LABEL_MAP[detected]||'_unknown';
  const profile=JSON.parse(JSON.stringify(DB[key]||DB['_unknown']));
  profile._confidence=confidence;scanResult=profile;arKey=key;
  slog('Device: '+profile.name,'r');
  slog('Issues: '+profile.components.filter(c=>c.status!=='OK').length+' found','o');
  renderResults(profile);renderAR(profile);sGlitch();
}

function renderResults(p){
  document.getElementById('devname').textContent=p.name;
  document.getElementById('devtype').textContent=p.type;
  const issues=p.components.filter(c=>c.status!=='OK').length;
  const cc=p.condition==='GOOD'?'g':p.condition==='FAIR'?'o':'r';
  document.getElementById('condstrip').innerHTML=`<div class="cchip ${cc}">‚óè ${p.condition} CONDITION</div><div class="cchip ${issues<=0?'g':issues<=2?'o':'r'}">${issues} ISSUES FOUND</div><div class="cchip">${p.components.length} CHECKED</div>${p._confidence?`<div class="cchip g">AI: ${p._confidence}%</div>`:''}`;
  const stM={OK:'ok',WORN:'worn',DAMAGED:'dmg',MISSING:'dmg',CORRODED:'dmg'};
  const prM={LOW:'lo',MEDIUM:'med',HIGH:'hi',CRITICAL:'hi'};
  document.getElementById('dtbody').innerHTML=p.components.map(c=>`<tr><td class="part-name">${c.name}</td><td class="sbody p" style="color:var(--muted);font-size:.72rem;line-height:1.5">${c.obs}</td><td><span class="stag ${stM[c.status]||'unk'}">${c.status}</span></td><td><span class="ptag ${prM[c.priority]||'med'}">${c.priority}</span></td></tr>`).join('');
  document.getElementById('toolsrow').innerHTML=p.tools.map(t=>`<div class="tool">${t}</div>`).join('');
  document.getElementById('stepswrap').innerHTML=p.steps.map((s,i)=>`<div class="sstep"><div class="snum">${i+1}</div><div class="sbody"><strong>${s.title}</strong><p>${s.detail}</p></div></div>`).join('');
  const res=document.getElementById('sresults');res.style.display='block';res.classList.add('on');
}

function renderAR(profile){
  const zones=AR_ZONES[arKey]||AR_ZONES['_unknown'];
  const bigImg=document.getElementById('arBigImg');bigImg.src=imgEl.src;
  const arSection=document.getElementById('arSection');arSection.style.display='block';arSection.classList.add('on');
  bigImg.onload=()=>drawARBig(profile,zones);
  if(bigImg.complete)drawARBig(profile,zones);
  const prM={LOW:'lo',MEDIUM:'med',HIGH:'hi',CRITICAL:'hi'};
  document.getElementById('arChipBar').innerHTML=zones.map((z,i)=>{const comp=profile.components[z.idx]||{};const cls=prM[comp.priority||'MEDIUM']||'med';return `<div class="ar-chip ${cls}" id="chip_${i}" onclick="selectZone(${i})"><div class="cdot"></div>${z.label}</div>`;}).join('');
  arSection.scrollIntoView({behavior:'smooth',block:'start'});slog('AR overlay active. Click chips to highlight.','g');
}

function drawARBig(profile,zones,hiIdx=null){
  const bigImg=document.getElementById('arBigImg'),canvas=document.getElementById('arBigCanvas');
  canvas.width=bigImg.offsetWidth;canvas.height=bigImg.offsetHeight;
  canvas.style.width=bigImg.offsetWidth+'px';canvas.style.height=bigImg.offsetHeight+'px';
  const ctx=canvas.getContext('2d');ctx.clearRect(0,0,canvas.width,canvas.height);
  const W=canvas.width,H=canvas.height;
  zones.forEach((z,i)=>{
    const isHi=hiIdx===i,col=z.color;
    const cx=z.x*W,cy=z.y*H,bw=z.w*W,bh=z.h*H,bx=cx-bw/2,by=cy-bh/2;
    ctx.save();
    ctx.shadowColor=col;ctx.shadowBlur=isHi?24:8;ctx.strokeStyle=col;ctx.lineWidth=isHi?3:1.5;ctx.globalAlpha=isHi?1:.65;
    ctx.setLineDash(isHi?[0]:[6,4]);ctx.strokeRect(bx,by,bw,bh);
    const cs=Math.min(bw,bh)*.18;ctx.setLineDash([]);ctx.lineWidth=isHi?3:2;ctx.globalAlpha=isHi?1:.85;
    [[bx,by],[bx+bw,by],[bx,by+bh],[bx+bw,by+bh]].forEach(([px,py],ci)=>{ctx.beginPath();ctx.moveTo(px+(ci%2===0?cs:-cs),py);ctx.lineTo(px,py);ctx.lineTo(px,py+(ci<2?cs:-cs));ctx.stroke();});
    if(isHi){ctx.globalAlpha=.12;ctx.fillStyle=col;ctx.fillRect(bx,by,bw,bh);ctx.globalAlpha=1;}
    ctx.beginPath();ctx.arc(cx,cy,isHi?7:4,0,Math.PI*2);ctx.fillStyle=col;ctx.shadowBlur=isHi?20:10;ctx.globalAlpha=isHi?1:.8;ctx.fill();
    const label=z.label;ctx.font=`bold ${isHi?13:11}px 'JetBrains Mono',monospace`;const tw=ctx.measureText(label).width;
    const tagX=Math.min(bx,W-tw-20),tagY=Math.max(by-8,14);
    ctx.shadowBlur=0;ctx.globalAlpha=isHi?1:.9;ctx.fillStyle='rgba(0,0,0,.85)';ctx.fillRect(tagX-4,tagY-13,tw+10,18);ctx.fillStyle=col;ctx.fillText(label,tagX,tagY);
    ctx.beginPath();ctx.strokeStyle=col;ctx.lineWidth=1;ctx.globalAlpha=isHi?.8:.4;ctx.moveTo(tagX+tw/2,tagY+2);ctx.lineTo(cx,cy);ctx.stroke();
    if(isHi){const t=Date.now()/800;const scanY=by+((t%1)*bh);ctx.globalAlpha=.4;ctx.strokeStyle=col;ctx.lineWidth=1.5;ctx.setLineDash([]);ctx.beginPath();ctx.moveTo(bx,scanY);ctx.lineTo(bx+bw,scanY);ctx.stroke();}
    ctx.restore();
  });
}

function animateAR(profile,zones,idx){
  if(arAnimFrame)cancelAnimationFrame(arAnimFrame);
  function frame(){drawARBig(profile,zones,idx);if(activeZone===idx)arAnimFrame=requestAnimationFrame(frame);}
  frame();
}

function selectZone(i){
  if(!scanResult)return;
  const zones=AR_ZONES[arKey]||AR_ZONES['_unknown'],profile=scanResult,comp=profile.components[zones[i].idx]||{};
  if(activeZone===i){activeZone=null;if(arAnimFrame)cancelAnimationFrame(arAnimFrame);drawARBig(profile,zones,null);document.getElementById('arInstruction').style.display='none';document.querySelectorAll('.ar-chip').forEach(c=>c.classList.remove('active'));return;}
  activeZone=i;document.querySelectorAll('.ar-chip').forEach((c,ci)=>c.classList.toggle('active',ci===i));animateAR(profile,zones,i);
  const relStep=profile.steps.find(s=>s.title.toLowerCase().includes(zones[i].label.toLowerCase().split(' ')[0])||s.detail.toLowerCase().includes(zones[i].label.toLowerCase().split(' ')[0]))||profile.steps[0];
  const inst=document.getElementById('arInstruction');
  inst.innerHTML=`<strong style="color:${zones[i].color};letter-spacing:2px">‚ñ∏ ${comp.name||zones[i].label}</strong><br><span style="color:rgba(255,255,255,.5);font-size:.66rem">STATUS: ${comp.status||'UNKNOWN'} ¬∑ PRIORITY: ${comp.priority||'‚Äî'}</span><br><br><strong>OBSERVATION:</strong> ${comp.obs||'Inspect carefully.'}<br><br><strong style="color:#00ff88">REPAIR ACTION:</strong> ${relStep.title} ‚Äî ${relStep.detail}`;
  inst.style.display='block';slog('AR: '+zones[i].label+' ‚Äî '+comp.status,'g');
}

function buildReport(){
  if(!scanResult)return;
  const p=scanResult,now=new Date(),ts=now.toLocaleDateString()+' '+now.toLocaleTimeString();
  const hash='0x'+Array.from({length:20},()=>Math.floor(Math.random()*16).toString(16)).join('').toUpperCase();
  const issues=p.components.filter(c=>c.status!=='OK');
  document.getElementById('rmeta').innerHTML=`REPORT: ${hash.slice(0,14)}<br>TIME: ${ts}<br>TYPE: ${p.type}`;
  document.getElementById('rs1').textContent=p.type;document.getElementById('rs2').textContent=p.components.length;document.getElementById('rs3').textContent=issues.length;document.getElementById('rs4').textContent=p.steps.length;
  const stM={OK:'#00ff88',WORN:'#ff8800',DAMAGED:'#ff4444',MISSING:'#ff0000',CORRODED:'#ff5500'};
  document.getElementById('rfull').innerHTML=`<div style="margin-bottom:14px;padding:13px;background:rgba(255,0,0,.04);border:1px solid rgba(255,0,0,.15)"><div style="color:var(--accent);font-size:.63rem;letter-spacing:2px;margin-bottom:9px">‚ñ∏ COMPONENT STATUS</div>${p.components.map(c=>`<div style="display:flex;align-items:flex-start;gap:11px;padding:7px 0;border-bottom:1px solid rgba(255,0,0,.08)"><span style="color:${stM[c.status]||'#ff8800'};font-weight:800;font-size:.68rem;min-width:55px">${c.status}</span><span style="color:#fff;font-weight:800;font-size:.7rem;min-width:160px">${c.name}</span><span style="color:rgba(255,255,255,.5);font-size:.68rem;flex:1">${c.obs}</span></div>`).join('')}</div><div style="padding:13px;background:rgba(255,0,0,.04);border:1px solid rgba(255,0,0,.15)"><div style="color:var(--accent);font-size:.63rem;letter-spacing:2px;margin-bottom:9px">‚ñ∏ REPAIR PROTOCOL</div>${p.steps.map((s,i)=>`<div style="display:flex;gap:11px;margin-bottom:10px"><div style="width:22px;height:22px;border-radius:50%;border:2px solid var(--accent);color:var(--accent);font-size:.66rem;font-weight:800;display:flex;align-items:center;justify-content:center;flex-shrink:0">${i+1}</div><div><div style="color:#fff;font-weight:800;font-size:.72rem;margin-bottom:2px">${s.title}</div><div style="color:rgba(255,255,255,.5);font-size:.68rem;line-height:1.6">${s.detail}</div></div></div>`).join('')}</div>`;
  document.getElementById('rhash').textContent='HASH: '+hash;
  const rp=document.getElementById('sreport');rp.style.display='block';rp.scrollIntoView({behavior:'smooth',block:'start'});slog('Report generated.','g');sGlitch();
}

function sleep(ms){return new Promise(r=>setTimeout(r,ms));}
function sGlitch(){const w=document.querySelector('.swrap');if(!w)return;w.classList.add('sglitch');setTimeout(()=>w.classList.remove('sglitch'),320);}

window.addEventListener('resize',()=>{
  if(scanResult&&document.getElementById('arSection').classList.contains('on')){
    const zones=AR_ZONES[arKey]||AR_ZONES['_unknown'];
    setTimeout(()=>drawARBig(scanResult,zones,activeZone),100);
  }
});
</script>
</body>
</html>